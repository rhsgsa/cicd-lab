= 3. CI/CD Initial Build

A CICD pipeline has been provisioned in your OpenShift namespace. Let's take a look at the pipeline in the OpenShift Console.

[start=1]

. Login to the {CONSOLE_URL}[OpenShift Console,window=console] in a new browser tab - select the `ldap_provider` and enter your assigned username and password
+
image::auth_providers.png[Authentication providers]

. Select the %USER% project / Pipelines / `build-and-deploy`
+
image::select_pipeline.png[Select pipeline]

. The pipeline clones from a Java source git repo, builds the application, creates a container image, pushes the container image to an image registry, and deploys the image to the Micorshift VM
+
image::pipeline.png[Pipeline]

. If you wish to examine the artifacts that were used to deploy the pipeline, you can look through the files in the {GIT_URL}/%USER%/pipeline[pipline git repo,window=git]

== Initial Build
include::_attributes.adoc[]

In this module, we will trigger the pipeline for the first time. We will do this by triggering a webhook from the application source git repo.

. Open the {GIT_URL}/%USER%/sample-app[application source git repo,window=git] in a new browser tab

. Sign in using your assigned username and password
+
image::login_to_gitea.png[Login to gitea]

. A webhook has been configured in this git repo to trigger the pipeline - examine the webhook by selecting menu:Settings[Webhooks > `\http://el-build-and-deploy...`]
+
image::webhook.png[Webhook]

. Trigger the webhook by scrolling to the bottom of the page and clicking on Test Delivery
+
image::test_delivery.png[Test Delivery]

. Examine the {CONSOLE_URL}/pipelines/ns/%USER%/pipeline-runs[PipelineRuns screen in the OpenShift Console,window=console] - you should see a new pipeline run running

. Wait for the pipeline run to fail due to security vulnerabilities that was flagged out by Advanced Cluster Security
+
image::acs-scan-failure.png[ACS Scan Failed]

. Open {GIT_URL}/%USER%/sample-app/src/branch/main/Docker[`Docker` in the `sample-app` git repo,window=git]

. Click on Edit File
+
image::edit_file.png[Edit File]

. Change the base image in line 1 from `registry.access.redhat.com/ubi8/ubi:8.8-1067.1697633337` to `registry.access.redhat.com/ubi8/ubi:latest`

. Commit the change
+
image::commit_change.png[Commit Change]

. Switch back to the OpenShift Console - a new pipeline run should have been triggered by the webhook

. Wait for the pipeline run to complete

. Test that the application is running properly by accessing the DevSpaces terminal and executing the following command: 
+
$ curl vmi-service.%USER%.svc.cluster.local:8080

. You should be able to see the following output on your terminal:
+
image::hello_world.png
